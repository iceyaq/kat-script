-- Define URLs for your scripts
local rayfieldURL = "https://raw.githubusercontent.com/username/repository/branch/rayfield.lua" -- Replace with your actual Rayfield URL
local featuresURL = "https://raw.githubusercontent.com/username/repository/branch/features.lua" -- Replace with your actual features URL

-- Function to safely load a script from a URL
local function safeLoad(url)
    local success, result = pcall(function()
        return loadstring(game:HttpGet(url))()
    end)
    if not success then
        warn("Failed to load script from URL: " .. url)
        warn("Error: " .. result)
        return nil
    end
    return result
end

-- Function to create and place a script in StarterPlayerScripts
local function placeScript(name, source)
    local StarterPlayer = game:GetService("StarterPlayer")
    local StarterPlayerScripts = StarterPlayer:FindFirstChild("StarterPlayerScripts")
    
    if not StarterPlayerScripts then
        StarterPlayerScripts = Instance.new("Folder")
        StarterPlayerScripts.Name = "StarterPlayerScripts"
        StarterPlayerScripts.Parent = StarterPlayer
    end

    local existingScript = StarterPlayerScripts:FindFirstChild(name)
    if existingScript then
        existingScript:Destroy()
    end

    local script = Instance.new("Script")
    script.Name = name
    script.Source = source
    script.Parent = StarterPlayerScripts
end

-- Load Rayfield GUI library
local Rayfield = safeLoad(rayfieldURL)
if not Rayfield then return end

-- Create GUI
local mainWindow = Rayfield:CreateWindow({
    Title = "Kat GUI",
    Icon = "https://www.example.com/your-custom-icon.png", -- Replace with your custom icon URL
    Load = function() print("Rayfield GUI loaded") end
})

-- Feature Implementations
local function createSilentAim()
    -- Silent Aim Implementation
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer

    game:GetService("RunService").RenderStepped:Connect(function()
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end

        local closestPlayer = nil
        local shortestDistance = math.huge

        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (player.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).magnitude
                if distance < shortestDistance then
                    closestPlayer = player
                    shortestDistance = distance
                end
            end
        end

        if closestPlayer then
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(closestPlayer.Character.HumanoidRootPart.Position)
        end
    end)
end

local function createAimbot()
    -- Aimbot Implementation
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer

    game:GetService("RunService").RenderStepped:Connect(function()
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end

        local closestPlayer = nil
        local shortestDistance = math.huge

        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (player.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).magnitude
                if distance < shortestDistance then
                    closestPlayer = player
                    shortestDistance = distance
                end
            end
        end

        if closestPlayer then
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(closestPlayer.Character.HumanoidRootPart.Position)
        end
    end)
end

local function createESP()
    -- ESP Implementation
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer

    local function createESPForPlayer(player)
        if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

        local espLabel = Instance.new("BillboardGui")
        espLabel.Name = "ESPLabel"
        espLabel.Parent = player.Character.HumanoidRootPart
        espLabel.Size = UDim2.new(0, 200, 0, 50)
        espLabel.StudsOffset = Vector3.new(0, 3, 0)

        local textLabel = Instance.new("TextLabel")
        textLabel.Parent = espLabel
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = Color3.new(1, 0, 0)
        textLabel.TextStrokeTransparency = 0.5
        textLabel.Text = player.Name
    end

    Players.PlayerAdded:Connect(function(player)
        player.CharacterAdded:Connect(function()
            createESPForPlayer(player)
        end)
    end)

    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character then
            createESPForPlayer(player)
        end
    end
end

-- GUI Tabs and Features
local function createTab(name, featureFunctions)
    local tab = mainWindow:CreateTab(name)
    for featureName, func in pairs(featureFunctions) do
        tab:CreateSwitch(featureName, false, func)
    end
end

-- Define feature functions
local featureFunctions = {
    ["Enable Silent Aim"] = function(value)
        if value then
            createSilentAim()
        end
    end,
    ["Enable Aimbot"] = function(value)
        if value then
            createAimbot()
        end
    end,
    ["Enable ESP"] = function(value)
        if value then
            createESP()
        end
    end,
}

-- Create tabs with features
createTab("Silent Aim", {["Enable Silent Aim"] = featureFunctions["Enable Silent Aim"]})
createTab("Aimbot", {["Enable Aimbot"] = featureFunctions["Enable Aimbot"]})
createTab("ESP", {["Enable ESP"] = featureFunctions["Enable ESP"]})

-- Main Execution
local function execute()
    print("All features loaded successfully.")
end

-- Place the main script in StarterPlayerScripts
placeScript("KatMainScript", script.Source)

-- Execute the script
execute()
